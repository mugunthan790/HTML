<!DOCTYPE html>
<html>
<head>
<title>Stickman Runner with Coins & 3 Lives</title>
<style>
body{margin:0;font-family:Arial;background:#cceeff;overflow:hidden;}
#gameContainer{position:relative;width:100%;height:100vh;background:#cceeff;}
#ground{position:absolute;bottom:0;width:100%;height:100px;background:#eee;}

#player{
  position:absolute;bottom:100px;left:50px;width:40px;height:100px;transition:height 0.1s,bottom 0.1s;
}
.head{width:26px;height:26px;border-radius:50%;margin:auto;background:#ffccaa;}
.body{width:5px;height:30px;margin:2px auto;background:#333;}
.arms{width:40px;height:5px;margin:auto;background:#333;}
.legs{width:40px;display:flex;justify-content:space-between;}
.legs div{width:5px;height:35px;background:#333;animation:runLegs 0.3s infinite alternate;}
@keyframes runLegs{from{transform:rotate(25deg);}to{transform:rotate(-25deg);}}

/* Obstacles */
.obstacle{position:absolute;width:35px;height:50px;background:#ff4444;border-radius:5px;bottom:100px;}
.ob-fly{height:25px;bottom:180px;background:#5500aa;}

/* Coins */
.coin{position:absolute;width:20px;height:20px;border-radius:50%;background:gold;bottom:150px;box-shadow:0 0 5px gold;}

/* HUD & Game Over */
#hud{position:absolute;top:10px;left:10px;background:rgba(255,255,255,0.8);padding:10px 20px;border-radius:10px;}
#over{display:none;position:absolute;top:40%;left:50%;transform:translate(-50%,-50%);background:white;padding:30px;border-radius:15px;text-align:center;}
button{cursor:pointer;padding:10px 20px;}
</style>
</head>
<body>

<div id="gameContainer">
  <div id="ground"></div>

  <div id="player">
    <div class="head"></div>
    <div class="body"></div>
    <div class="arms"></div>
    <div class="legs">
      <div></div>
      <div></div>
    </div>
  </div>

  <div id="hud">Score: <span id="score">0</span> | Lives: <span id="lives">3</span> | Speed: <span id="speed">7</span></div>
  <div id="over">
    <h2>GAME OVER</h2>
    <p>Final Score: <span id="final"></span></p>
    <button onclick="location.reload()">Restart</button>
  </div>
</div>

<script>
// ================= VARIABLES =================
const player = document.getElementById("player");
const scoreEl = document.getElementById("score");
const livesEl = document.getElementById("lives");
const speedEl = document.getElementById("speed");
const over = document.getElementById("over");
const final = document.getElementById("final");

let jump=false, crouch=false, vel=0, gravity=0.8, y=0;
let score=0, speed=7, lives=3; // initial speed & lives
let run=true;
let obstacles=[], coins=[];

// ================= CONTROLS =================
document.addEventListener("keydown", e=>{
  if(!run) return;
  if(e.code==="ArrowUp" && !jump && !crouch){
    vel=16; jump=true;
  }
  if(e.code==="ArrowDown" && !jump){
    crouch=true;
    player.style.height="50px";
    player.style.bottom="100px";
  }
});
document.addEventListener("keyup", e=>{
  if(e.code==="ArrowDown"){crouch=false; player.style.height="100px";}
});

// ================= PLAYER PHYSICS =================
function movePlayer(){
  if(!run) return;
  vel -= gravity;
  y += vel;
  if(y<=0){y=0; vel=0; jump=false;}
  player.style.bottom=(y+100)+"px";
  requestAnimationFrame(movePlayer);
}

// ================= OBSTACLES =================
function createObstacle(){
  if(!run) return;
  let ob=document.createElement("div");
  ob.className="obstacle";
  if(Math.random()<0.3) ob.classList.add("ob-fly");

  // Random horizontal position off-screen
  ob.style.left = window.innerWidth + "px";
  document.body.appendChild(ob);
  obstacles.push(ob);
}

// ================= COINS =================
function createCoin(){
  if(!run) return;
  let coin = document.createElement("div");
  coin.className="coin";

  // ensure coins do not spawn at same vertical position as obstacles
  let safeBottom = 150 + Math.random()*50; // coins above ground
  coin.style.bottom = safeBottom + "px";
  coin.style.left = window.innerWidth + "px";
  document.body.appendChild(coin);
  coins.push(coin);
}

// ================= MOVE OBSTACLES & COINS =================
function moveObjects(){
  if(!run) return;
  const p = player.getBoundingClientRect();

  // Obstacles
  for(let i=obstacles.length-1;i>=0;i--){
    let ob = obstacles[i];
    let left = parseFloat(ob.style.left);
    left -= speed;
    ob.style.left = left + "px";

    let o = ob.getBoundingClientRect();
    if(p.right>o.left && p.left<o.right && p.bottom>o.top && p.top<o.bottom){
      obstacles.splice(i,1);
      ob.remove();
      lives--;
      livesEl.innerHTML = lives;
      if(lives<=0) gameOver();
    }

    if(left + ob.offsetWidth < 0){
      ob.remove();
      obstacles.splice(i,1);
    }
  }

  // Coins
  for(let i=coins.length-1;i>=0;i--){
    let c = coins[i];
    let left = parseFloat(c.style.left);
    left -= speed;
    c.style.left = left + "px";

    let coinRect = c.getBoundingClientRect();
    if(p.right>coinRect.left && p.left<coinRect.right && p.bottom>coinRect.top && p.top<coinRect.bottom){
      score += 50;
      scoreEl.innerHTML = score;
      coins.splice(i,1);
      c.remove();
    }

    if(left + c.offsetWidth < 0){
      c.remove();
      coins.splice(i,1);
    }
  }

  requestAnimationFrame(moveObjects);
}

// ================= SCORE & SPEED =================
setInterval(()=>{
  if(run){
    score++;
    scoreEl.innerHTML = score;
    if(score%200===0){speed++; speedEl.innerHTML = speed;}
  }
},100);

// ================= SPAWN LOOP =================
function spawnLoop(){
  if(!run) return;
  createObstacle();
  createCoin(); // always separate
  setTimeout(spawnLoop, 1000 + Math.random()*1000);
}

// ================= GAME OVER =================
function gameOver(){
  run=false;
  final.innerHTML = score;
  over.style.display="block";
}

// ================= START =================
movePlayer();
moveObjects();
spawnLoop();
</script>
</body>
</html>